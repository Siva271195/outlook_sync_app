{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Internal Tickets Schema",
  "type": "object",
  "required": ["event_type", "table", "primary_key"],
  "properties": {
    "event_type": {
      "type": "string",
      "enum": ["INSERT", "UPDATE", "DELETE"]
    },
    "table": {
      "type": "string",
      "const": "tickets"
    },
    "primary_key": {
      "type": "object",
      "required": ["ticket_id"],
      "properties": {
        "ticket_id": {"type": "string"}
      }
    },
    "before": {
      "type": "object",
      "properties": {
        "ticket_id": {"type": "string"},
        "title": {"type": "string"},
        "status": {"type": "string"},
        "assignee_id": {"type": "integer"},
        "priority": {"type": "string"}
      }
    },
    "after": {
      "type": "object",
      "properties": {
        "ticket_id": {"type": "string"},
        "title": {"type": "string"},
        "status": {"type": "string"},
        "assignee_id": {"type": "integer"},
        "priority": {"type": "string"}
      }
    }
  },
  "anyOf": [
    {
      "properties": {
        "event_type": {"const": "INSERT"}
      },
      "required": ["after"]
    },
    {
      "properties": {
        "event_type": {"const": "UPDATE"}
      },
      "required": ["before", "after"]
    },
    {
      "properties": {
        "event_type": {"const": "DELETE"}
      },
      "required": ["before"]
    }
  ]
}